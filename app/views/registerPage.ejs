<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Register</title>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css'>
  </link>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</head>
<%- include('partials/navbarPublic', {loginPage : false}) %>

  <body>
    <style>
      body {
        background: #caeee5;
        display: flex;
        justify-content: center;
        /* horizontally center */
        align-items: center;
        /* vertically center */
      }

      .main {
        width: 75vh;
        height: 100vh;
        margin: 10px;
        /* center horizontally */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .main-container {
        background: white;
        justify-content: center;
      }
    </style>

    <div class="main">
      <div class="main-container m-2 p-3 basic-details">
        <h3 class="row g-3 p-2 m-3">BASIC DETAILS</h3>
        <div id="registrationForm" class="row g-3 p-2 m-2">
          <div class="col-md-4">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" class="form-control" id="firstName" name="firstName">
          </div>
          <div class="col-md-4">
            <label for="middleName" class="form-label">Middle Name</label>
            <input type="text" class="form-control" id="middleName" name="middleName">
          </div>
          <div class="col-md-4">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" class="form-control" id="lastName" name="lastName">
          </div>

          <div class="col-md-7">
            <label for="inputEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="inputEmail" name="email">
          </div>
          <div class="col-md-5">
            <label for="dateOfBirth" class="form-label">Date OF Birth</label>
            <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth">
          </div>
          <div class="col-md-6">
            <label for="inputPassword" class="form-label">Password</label>
            <input type="password" class="form-control" id="inputPassword" name="password">
          </div>
          <div class="col-md-6">
            <label for="confirmPassword" class="form-label">Confirm Password</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
            <div id="passwordError" class="text-danger"></div>
          </div>
          <div class="col-12">
            <label for="inputAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="inputAddress" name="address" placeholder="1234 Main St">
          </div>
          <div class="col-md-5">
            <label for="inputCity" class="form-label">City</label>
            <input type="text" class="form-control" id="inputCity" name="city">
          </div>
          <div class="col-md-5">
            <label for="inputState" class="form-label">State</label>
            <select id="inputState" class="form-select" name="state">
              <option value="" selected>Choose...</option>
              <option value="" selected>Choose...</option>
              <option value="Andhra Pradesh">Andhra Pradesh</option>
              <option value="Arunachal Pradesh">Arunachal Pradesh</option>
              <option value="Assam">Assam</option>
              <option value="Bihar">Bihar</option>
              <option value="Chhattisgarh">Chhattisgarh</option>
              <option value="Goa">Goa</option>
              <option value="Gujarat">Gujarat</option>
              <option value="Haryana">Haryana</option>
              <option value="Himachal Pradesh">Himachal Pradesh</option>
              <option value="Jharkhand">Jharkhand</option>
              <option value="Karnataka">Karnataka</option>
              <option value="Kerala">Kerala</option>
              <option value="Madhya Pradesh">Madhya Pradesh</option>
              <option value="Maharashtra">Maharashtra</option>
              <option value="Manipur">Manipur</option>
              <option value="Meghalaya">Meghalaya</option>
              <option value="Mizoram">Mizoram</option>
              <option value="Nagaland">Nagaland</option>
              <option value="Odisha">Odisha</option>
              <option value="Punjab">Punjab</option>
              <option value="Rajasthan">Rajasthan</option>
              <option value="Sikkim">Sikkim</option>
              <option value="Tamil Nadu">Tamil Nadu</option>
              <option value="Telangana">Telangana</option>
              <option value="Tripura">Tripura</option>
              <option value="Uttar Pradesh">Uttar Pradesh</option>
              <option value="Uttarakhand">Uttarakhand</option>
              <option value="West Bengal">West Bengal</option>
              <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
              <option value="Chandigarh">Chandigarh</option>
              <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
              <option value="Delhi">Delhi</option>
              <option value="Lakshadweep">Lakshadweep</option>
              <option value="Puducherry">Puducherry</option>
              <option value="Jammu and Kashmir">Jammu and Kashmir</option>
              <option value="Ladakh">Ladakh</option>
            </select>
          </div>
          <div class="col-md-2">
            <label for="inputZip" class="form-label">Zip</label>
            <input type="text" class="form-control" id="inputZip" name="zip">
          </div>
          <div class="col-2">
            <button type="button" id="nextButton" class="btn btn-info mt-2">Next</button>
          </div>
        </div>
      </div>


      <div class="main-container m-1 p-3 personal-details" style="display: none;">
        <h3 class="row g-3 p-2 m-2">PERSONAL DETAILS</h3>
        <div id="personalDetailsForm" class="row g-3 p-2 m-2">

          <div class="col-md-12">
            <label for="blood_group" class="form-label">Blood Group</label>
            <select class="form-select" id="blood_group" name="blood_group">
              <option value="">Select Blood Group</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
          </div>

          <div class="col-md-12">
            <label for="vaccine_id" class="form-label">COVID Vaccination Certificate-1 ID</label>
            <input type="text" class="form-control" id="vaccine_id" name="vaccine_id">
          </div>

          <div class="col-md-12">
            <label for="vaccine_date" class="form-label">COVID Vaccination Certificate-1 Date</label>
            <input type="date" class="form-control" id="vaccine_date" name="vaccine_date">
          </div>

          <div class="col-md-12">
            <label for="city1" class="form-label">First Vaccination City Name</label>
            <input type="text" class="form-control" id="city1" name="city1">
          </div>

          <div class="col-md-12">
            <label for="city2" class="form-label">Second Vaccination City Name</label>
            <input type="text" class="form-control" id="city2" name="city2">
          </div>
          <br />
          <div class="col-2">
            <button class="btn btn-info mt-2" id="previousButton">Previous</button>
          </div>
          <div class="col-2">
            <button type="button" id="submitForm" class="btn btn-primary mt-2 ">Register</button>
          </div>


        </div>
      </div>
    </div>
    <%- include('partials/footer') %>
      <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
      <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
      <script>
        $(document).ready(function () {

          // $('.select2').select2();

          $('#nextButton').click(function () {
            $('.basic-details').hide();
            $('.personal-details').show();
          });

          $('#previousButton').click(function (e) {
            e.preventDefault();
            $('.personal-details').hide();
            $('.basic-details').show();
          });

          $('#inputZip').mask('000000');

          $('#confirmPassword').on('change', function () {
            if ($('#inputPassword').val() !== $('#confirmPassword').val()) {
              $('.personal-details').hide();
              $('.basic-details').show();
              $('#passwordError').text('Passwords do not match');
              return;
            }
            $('#passwordError').text('');
          });

          $('#submitForm').click(function (event) {
            event.preventDefault();
            let firstName = $('#firstName').val();
            let middleName = $('#middleName').val();
            let lastName = $('#lastName').val();
            let email = $('#inputEmail').val();
            let password = $('#inputPassword').val();
            let confirmPassword = $('#confirmPassword').val();
            let address = $('#inputAddress').val();
            let city = $('#inputCity').val();
            let state = $('#inputState').val();
            let zip = $('#inputZip').val();
            let dateOfBirth = $('#dateOfBirth').val();

            let bloodGroup = $('#blood_group').val();
            let vaccineId = $('#vaccine_id').val();
            let vaccineDate = $('#vaccine_date').val();
            let city1 = $('#city1').val();
            let city2 = $('#city2').val();

            if (password !== confirmPassword) {
              $('.personal-details').hide();
              $('.basic-details').show();
              $('#passwordError').text('Passwords do not match');
              return;
            }
            $('#passwordError').text('');

            // Form is valid, make AJAX request to backend
            $.ajax({
              url: '/register',
              method: 'POST',
              data: {
                firstName: firstName,
                middleName: middleName,
                lastName: lastName,
                email: email,
                password: password,
                confirmPassword: confirmPassword,
                dateOfBirth: dateOfBirth,
                address: address,
                city: city,
                state: state,
                zip: zip,
                bloodGroup: bloodGroup,
                vaccineId : vaccineId,
                vaccineDate : vaccineDate,
                city1 : city1,
                city2 : city2
              },
              success: function (response) {
                console.log(response);
                if (response.status) {
                  console.log("inside if", response.message);
                  swal({
                    title: response.message,
                    type: 'success',
                    icon: 'success',
                    button: 'OK',
                    timer: 2000, // Auto close after 2 seconds
                    showConfirmButton: false // Hide the "OK" button
                  }).then(() => {

                    window.location.href = response.url;
                  });
                } else {
                  console.log("inside else", response.message);
                  swal({
                    title: 'Registration Failed',
                    text: response.message,
                    type: 'warning',
                    icon: 'warning',
                    button: 'OK'
                  });
                }
              },
              error: function (error) {
                console.log(error.message);
                if (!error.responseJSON.state) {
                  swal({
                    title: 'Registration Failed',
                    text: error.responseJSON.message,
                    type: 'warning',
                    icon: 'warning',
                    button: 'OK'
                  });
                }
                console.error(error);
              }
            });
          });
        });
      </script>
      </script>

</html>